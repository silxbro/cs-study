# 파일 시스템과 DBMS
<br/>

마당서점의 초기 전산화 과정을 통해 마당서점의 데이터가 컴퓨터에 어떻게 저장되는지 알아보자.
마당서점은 사장과 점원 한 명이 운영하고, 판매하는 도서가 5권이며, 고객은 주로 스포츠에 관심 있는 독자들이다.
<br/>
<br/>
## 1. 데이터를 저장하는 방법
마당서점은 취급하는 도서 수가 적어 사장과 점원이 도서 제목, 출판사, 가격 등을 모두 기억하고, 고객이 문의를 해오면 바로 대답해준다.
이 상태에서는 컴퓨터에 따로 데이터를 저장하여 관리할 필요가 없다. 그러나 앞으로 도서가 많아지고 고객 문의가 늘어나면 매번 같은 일을 반복하기 어려울 것이다.
그래서 사장은 도서에 관한 정보를 컴퓨터에 저장하고 고객이 직접 조회할 수 있도록 검색 프로그램을 제공하기로 했다.

다음 그림은 도서 검색 프로그램으로, 도서 5권의 정보를 저장하고 있으며 고객이 조회하면 바로 검색할 수 있다.
사용 방법은 0~5까지의 메뉴 중 원하는 메뉴를 입력하면 결과를 출력한다. 예를 들어 '0'을 입력하면 '모든 도서보기' 기능을 수행하여 모든 도서의 정보를 화면에 출력한다.
도서 검색 프로그램은 C, 자바 등의 프로그래밍 언어를 이용해서 만들고, 데이터는 파일 혹은 데이터베이스 시스템에 저장한다. 데이터를 어디에 저장했는지는 프로그램에 나타나지 않는다.

#### [도서 검색 프로그램]
<img src="https://github.com/silxbro/cs-study/assets/142463332/b7ea1d6c-04e9-4ea6-a3f5-e4f0e2bf30a5" width="500" height="300"/><br/>

위와 같이 프로그램이 운영되려면 도서의 제목, 출판사, 가격 등에 관한 데이터를 어딘가에는 저장해야 한다. 컴퓨터에 데이터를 저장하는 방법 세 가지를 살펴보자.

### (1) 데이터를 프로그램 내부에 저장하는 방법
비현실적이긴 하지만 데이터를 프로그램 내부에 저장하는 방법이다. 즉 데이터를 프로그램의 변수에 치환하여 저장하는 방법이다. 여기서는 C 언어로 프로그램을 작성한다.
작성된 코드는 다음과 같다. C 언어의 구조체 BOOK을 먼저 선언하고 main() 프로그램에서 구조체 배열 변수 BOOKS[]에 데이터를 저장한다.
도서 데이터는 프로그램 내 구조체 변수에 저장된다.

#### 🔳 프로그램1: 데이터를 프로그램 내부에 저장
```C
/* BOOK 데이터 구조 정의 */
typedef struct
{
    int    bookid[5];
    char   bookname[20];
    char   publisher[20];
    int    price;
} BOOK;

int main()
{
    BOOK BOOKS[10];

/* 구조체 배열 변수에 데이터 저장 */
      /* 첫 번째 도서 저장 */
      BOOKS[1].bookid=1;
      strcpy(BOOKS[1].bookname, "축구의 역사");
      strcpy(BOOKS[1].publisher, "굿스포츠");
      BOOKS[1].price=7000;

      /* 두 번째 도서 저장 */
      BOOKS[2].bookid=2;
      strcpy(BOOKS[2].bookname, "축구아는 여자");
      strcpy(BOOKS[2].publisher, "나무수");
      BOOKS[1].price=13000;

/* 나머지 다른 도서 저장(생략) */
      .....

/* 모든 도서보기 프로그램 호출 */
      search_all();

/* 기타 프로그램 코드 */
      .....
}
```
#### 🔳 문제점
위 프로그램은 데이터를 프로그램 내부의 BOOKS 배열에 저장한다. 그런데 이 방법은 문제가 있다.
새로운 도서 '야구를 부탁해'가 입고되어 고객들이 조회할 수 있도록 추가하려면 배열 변수 BOOKS의 마지막에 새로운 데이터를 저장하고 다시 컴파일한 후 실행시켜야 한다.
이 방법은 매번 새로운 데이터가 생길 때마다 프로그램을 수정한 후 다시 컴파일하고, 새로 컴파일된 프로그램을 실행시켜야 한다.
또 프로그램을 컴파일하여 새로운 프로그램을 가동시키는 순간 검색 서비스를 중단시켜야 한다.
데이터를 프로그램 내부에 저장하는 방법은 데이터의 추가나 삭제 같은 변경 작업이 없다면 아무 문제가 없지만, 데이터는 항상 변경이 일어나기 때문에 문제가 발생한다.

### (2) 파일 시스템을 사용하는 방법
데이터를 프로그램과 분리하여 별도의 파일에 저장하는 방법이다. 이를 파일 시스템이라고 한다.
파일은 프로그램과 분리되어 컴퓨터의 디스크에 저장되며, 컴퓨터가 꺼진 상태에도 데이터 값을 유지한다. C 언어로 작성한 도서 검색 프로그램은 다음 그림과 같다.
새로운 도서가 추가되면 프로그램과 분리되어 별도의 파일에 저장된다.

#### [도서 검색 프로그램에서 도서를 등록하는 화면]
<img src="https://github.com/silxbro/cs-study/assets/142463332/bbd115c2-c803-423f-bdb7-48edf15cca41" width="500" height="300"/><br/>

위 프로그램의 코드는 다음과 같다. BOOK 데이터 구조를 먼저 선언하고 main() 프로그램에서 파일로부터 데이터를 불러와 구조체 배열 변수 BOOKS[]에 저장한다.
새로운 도서가 입고되면 '도서등록하기' 화면에서 도서 정보를 입력받아 파일에 저장한다.
새로운 데이터가 추가되어도 프로그램을 수정할 필요가 없기 때문에 첫 번째 방법의 문제점이 해결된다.

#### 🔳 프로그램2: 데이터를 프로그램 내부에 저장
```C
/* BOOK 데이터 구조 정의 */
typedef struct
{
    int     bookid[5];
    char    bookname[20];
    char    publisher[20];
    int     price;
} BOOK;

int main()
{
    BOOK BOOKS[10];
    int i=1;

    /* 도서 입력 함수 */
    insert();

    /* 파일에 저장된 데이터를 배열 BOOKS[]에 저장 */
    fp=fopen("book.dat","rb");
    bp=(BOOK *)calloc(1,sizeof(BOOK));

    /* 파일에서 책을 읽는다 */
    while(fread(bp,sizeof(BOOK),1,fp) != 0)
    {
          BOOKS[i].bookid=bp->bookid;
          strcpy(BOOKS[i].bookname, bp->bookname);
          strcpy(BOOKS[i].publisher, bp->publisher);
          BOOKS[i].price=bp->price;
          i++;
    }

    /* 모든 도서보기 프로그램 호출 */
    search_all();

    /* 기타 프로그램 코드 */
    .....
}
```
#### 🔳 문제점
위 프로그램은 데이터가 변경되어도 데이터를 파일에 별도로 저장하여 운영하기 때문에 프로그램 자체를 수정하지 않아도 된다. 따라서 고객은 24시간 검색 서비스를 제공받을 수 있다.
그러나 다음과 같이 사용자가 인식하지 못하는 두 가지 문제가 있다.

첫째, 데이터 구조가 바뀌는 문제가 있다. 문제라기보다는 불편함이라고 할 수 있다.
도서 정보는 BOOK 데이터 구조에서 선언했다시피 (도서번호, 도서제목, 출판사, 가격)을 저장한다.
그러나 운영하다보니 저자 정보도 필요하여 BOOK 데이터 구조를 (도서번호, 도서제목, 출판사, 저자, 가격)으로 변경하려고 한다.
해결 방법은 프로그램을 수정하여 새로운 BOOK 데이터 구조를 정의하고 다시 컴파일하는 것이다. 컴파일된 프로그램을 다시 시작하려면 검색 서비스를 일시 중단해야 한다.

둘째, 같은 파일을 두 개의 프로그램이 공유하는 문제이다. 예를 들어 같은 데이터를 book.dat 파일에 저장했다고 가정하자.
고객이 도서를 검색하기 위해 P1 프로그램을 이용하여 book.dat 파일을 읽는 동안 직원이 도서의 가격을 조회하기 위해 P2 프로그램으로 book.dat 파일을 읽으려고 한다.
이때 직원은 '파일이 사용 중입니다...'라는 오류 메시지를 만나게 된다. P2 프로그램이 book.dat 파일을 읽으려면 P1 프로그램을 잠시 중지시켜야 한다. 이는 고객에게 불편한 일이다.
- 한 개의 파일을 두 개의 프로그램이 공유하는 것은 운영체제의 도움 없이는 불가능하다.

### (3) DBMS를 사용하는 방법
데이터는 데이터 정의와 데이터 값으로 구성된다.
앞서 설명한 첫 번째 방법은 프로그램 내부에 데이터 정의와 데이터 값을 모두 포함하는 경우고, 두 번째 방법은 프로그램 내부에 데이터 정의만 포함하고 데이터 값은 별도의 파일에
저장하는 경우이다.

이제 설명할 세 번째 방법은 데이터 정의와 데이터 값을 DBMS라는 소프트웨어가 관리하는 방법으로, 앞서 설명한 두 가지 방법의 문제점을 모두 해결할 수 있다.
프로그램에 데이터 정의나 데이터 값을 포함하지 않기 때문에 데이터 구조가 바뀌어도 다시 컴파일할 필요가 없다(단, 프로그램이 직접 다루는 데이터 정의가 바뀌면 다시 컴파일해야 한다).
데이터 정의와 데이터 값은 DBMS가 관리한다. DBMS는 데이터 정의, 데이터 변경 등의 작업을 할 수 있는 별도의 프로그램을 갖고 있다.

C 언어와 데이터베이스 전용 언어인 SQL로 작성된 코드는 다음과 같다. 고객이 사용하는 프로그램은 두 번째 방법과 같지만, 프로그램에서 BOOK 데이터 구조는 빠져 있다.
프로그램에서 데이터를 불러올 때는 `EXEC SQL` 이라는 별도의 명령어를 이용하여 DBMS에 호출한다. DBMS는 데이터를 정의하고 데이터를 관리하는 사용자 인터페이스를 따로 제공한다.

#### 🔳 프로그램3: 데이터를 DBMS에 저장
```C
int main()
{
    /* 반횐된 행의 수 */
    int num_ret;

    /* DBMS에 접속 */
    EXEC SQL CONNECT :username IDENTIFIED BY :password;

    /* SQL 문 실행 */
    EXEC SQL DECLARE c1 CURSOR FOR
          SELECT bookname, publisher, price FROM BOOK;
    EXEC SQL OPEN c1;

    /* 모든 도서보기 프로그램 호출 */
    search_all();

    /* SQL 문 실행 결과 출력 */
    for(;;) {
            EXEC SQL FETCH c1 INTO :BOOK_rec;
            print_rows(num_ret);
    }
    EXEC SQL CLOSE c1;

    /* 접속 해제 */
    EXEC SQL COMMIT WORK RELEASE;
}
```

다음 그림은 오라클사의 DBMS인 MySQL의 데이터베이스 관리 소프트웨어인 MySQL Workbench이다.
Workbench 프로그램은 데이터 구조를 만들고 저장된 데이터 값을 직접 변경할 수 있어 편리하다. 변경 시 다른 응용 프로그램에는 영향이 없다.

#### [MySQL Workbench의 데이터베이스 관리 화면]
<img src="https://github.com/silxbro/cs-study/assets/142463332/f6de25fe-a01a-4532-8681-3dc35f29f35d" width="500" height="300"/><br/>
<br/>

## 2. 데이터의 저장 방법 비교
마당서점 데이터의 세 가지 저장 방법을 비교하면 다음과 같다.

#### [마당서점 데이터의 저장 방법 비교]
|저장 방법|구조|설명|
|:---|:---|:---|
|프로그램1|<img src="https://github.com/silxbro/cs-study/assets/142463332/12637a02-af13-4c4c-8310-d01975266917" width="190" height="180"/><br/>|- 프로그램에 데이터 정의와 데이터 값을 모두 포함하는 방식<br/>- 프로그램에 BOOK 데이터 구조를 정의하고 데이터 값도<br/>&nbsp;&nbsp;&nbsp;직접 변수에 저장함<br/>- 데이터 구조 혹은 데이터 값이 바뀌면 프로그램을 다시<br/>&nbsp;&nbsp;&nbsp;컴파일해야 함|
|프로그램2|<img src="https://github.com/silxbro/cs-study/assets/142463332/cbaf3021-cdef-407c-bf3d-c94f47ee26b5" width="200" height="220"/><br/>|- 파일에 데이터 값, 프로그램에 데이터 정의를 포함하는 방식<br/>- 프로그램에 BOOK 데이터 구조만 정의하고, 데이터 값은<br/>&nbsp;&nbsp;&nbsp;book.dat라는 파일에 저장됨<br/>- 데이터 값이 바뀌면 프로그램에 변경이 없지만, 데이터 구조가<br/>&nbsp;&nbsp;&nbsp;바뀌면 프로그램을 다시 컴파일해야 함|
|프로그램3|<img src="https://github.com/silxbro/cs-study/assets/142463332/6ee21da9-95a9-4664-a660-d9283feb5fce" width="200" height="250"/><br/>|- DBMS가 데이터 정의와 데이터 값을 관리하는 방식<br/>- BOOK 데이터 구조는 DBMS가 관리하고, 데이터 값은<br/>&nbsp;&nbsp;&nbsp;데이터베이스에 저장됨<br/>- 데이터 구조가 바뀌거나 데이터 값이 바뀌어도 프로그램을<br/>&nbsp;&nbsp;&nbsp;다시 컴파일할 필요 없음|

<br/>

## 3. 파일 시스템과 DBMS의 비교
마당서점 데이터를 저장하는 방법 중 두 번째 방법과 세 번째 방법을 비교하여, 왜 세 번째 방법이 좋은지 알아보자.
마당서점 데이터를 저장하는 두 번째 방법은 데이터를 파일에 저장하여 관리하는 방법이고, 세 번째 방법은 데이터를 DBMS라는 소프트웨어를 통해 관리하는 방법이다.
DBMS는 파일 시스템에 비해 CPU와 주기억장치 등 컴퓨터 자원을 많이 사용하지만 SQL 언어를 사용하여 응용 프로그램이 데이터에 쉽게 접근할 수 있도록 한다.
즉 프로그래머가 해야 할 파일 관리를 DBMS를 통해 쉽게 할 수 있다.

#### [파일 시스템과 DBMS의 비교]
|구분|파일 시스템|DBMS|
|:---|:---|:---|
|데이터 정의 및 저장|데이터 정의: 응용 프로그램<br/>데이터 저장: 파일 시스템|데이터 정의: DBMS<br/>데이터 저장: 데이터베이스|
|데이터 접근 방법|응용 프로그램이 파일에 직접 접근|응용 프로그램이 DBMS에 파일 접근을 요청|
|사용 언어|자바, C++, C 등|자바, C++, C 등과 SQL|
|CPU/주기억장치 사용|적음|많음|

구체적인 예를 들어 파일 시스템과 DBMS를 비교해보자.

마당서점에는 출판사로부터 도서를 사오는 구매 담당자와 고객에게 도서를 판매하는 판매 담당자가 있다. 이들은 서로 업무가 달라 필요한 프로그램을 각각 운영한다.
다음 그림은 구매 담당자와 판매 담당자의 업무를 파일 시스템으로 처리한 경우이다. 파일 시스템으로 구축된 응용 프로그램은 데이터가 저장될 파일을 정의하고 직접 관리한다.
따라서 프로그램 개발 시 파일을 다루어야 하는 부담이 있다. 또 파일에 저장된 데이터를 서로 공유하지 않기 때문에 데이터가 중복 저장될 위험이 있다.
데이터가 중복 저장되면 데이터를 이중으로 관리하여 데이터의 일관성 유지가 어려워질 수 있는데, 예를 들어 구매 담당자가 변경한 도서 정보를 판매 담당자가 알지 못해 문제가
생기기도 한다.

#### [파일 시스템으로 구축된 구매 및 판매 응용 프로그램]
<img src="https://github.com/silxbro/cs-study/assets/142463332/30b42d58-72e2-4d98-a9fd-82126906456c" width="400" height="150"/><br/>

다음 그림은 DBMS로 구축된 구매 및 판매 응용 프로그램으로, 데이터의 정의 및 관리를 DBMS에 맡기기 때문에 프로그램이 훨씬 간단하다.
즉 프로그램 개발 생산성이 높다. DBMS는 데이터베이스 정의 시 도서에 관한 정보를 한 번만 정의하여 공유하기 때문에 데이터의 일관성을 유지할 수 있다.
응용 프로그램 입장에서는 데이터의 정의와 관리를 맡지 않아 데이터 구조 변경으로부터 독립성을 유지할 수 있다.
또 DBMS는 스스로 데이터를 복구하며 보안을 유지하는 기능도 갖고 있다.

#### [DBMS로 구축된 구매 및 판매 응용 프로그램]
<img src="https://github.com/silxbro/cs-study/assets/142463332/423e20d0-ebc8-4cd0-99e2-af231285cc55" width="480" height="150"/><br/>

다음 표는 파일 시스템과 비교하여 DBMS의 장점을 정리한 것이다.
표에서 보듯이 DBMS를 이용하면 데이터를 많이 다루는 프로그램을 빨리 개발할 수 있고, 데이터 구조가 변경되어도 데이터의 독립성을 유지할 수 있다.
또 복구, 보안, 무결성 유지 등의 기능도 수행한다.

#### [DBMS의 장점]
|구분|파일 시스템|DBMS|
|:---|:---|:---|
|데이터 중복|데이터를 파일 단위로 저장하므로 중복 가능성 높음|DBMS를 이용하여 데이터를 공유하기 때문에<br/>중복 가능성 낮음|
|데이터 일관성|데이터의 중복 저장으로 일관성이 결여됨|중복 제거로 데이터의 일관성이 유지됨|
|데이터 독립성|데이터 정의와 프로그램의 독립성 유지 불가능|데이터 정의와 프로그램의 독립성 유지 가능|
|관리 기능|보통|데이터 복구, 보안, 동시성 제어, 데이터 관리<br/>기능 등을 수행|
|프로그램 개발 생산성|나쁨|짧은 시간에 큰 프로그램을 개발할 수 있음|
|기타 장점|별도의 소프트웨어 설치가 필요 없음|데이터 무결성 유지, 데이터 표준 준수 용이|