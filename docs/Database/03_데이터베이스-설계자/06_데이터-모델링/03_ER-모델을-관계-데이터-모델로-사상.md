# ER 모델을 관계 데이터 모델로 사상
<br/>

ER 모델은 데이터베이스 생명주기의 개념적 모델링에서 사용하는 모델로, ER 다이어그램을 통해 완성된다.
완성된 ER 모델은 실제 데이터베이스로 구축하기 위해 논리적 모델링 단계를 거치는데, 이 단계에서 사상(mapping)이 이루어진다.
이 절에서는 논리적 모델링에 가장 많이 사용되는 관계 데이터 모델을 기준으로 ER 모델을 관계 데이터 모델로 사상하는 방법에 대해 살펴본다.

#### [ER 모델을 관계 데이터 모델로 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/d39cb44d-e03e-4958-9c47-bf3377bbaf80" width="350" height="230"/><br/>

관계 데이터 모델은 릴레이션 하나로 데이터베이스의 논리적 구조를 표현하지만 ER 모델은 개체 타입, 관계 타입, 속성으로 표현한다.
따라서 사상은 각각 개체 타입의 유형과 관계 타입의 유형에 따라 다른 방법으로 진행된다. ER 모델을 관계 데이터 모델로 사상하는 방법은 다음과 같이 7단계 알고리즘으로 나타낼 수 있다.

#### [ER 모델과 관계 데이터 모델의 사상 알고리즘]
|단계|사상할 대상|구분|
|:---|:---|:---|
|1단계&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|개체 타입&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|강한 개체 타입|
|2단계|개체 타입|약한 개체 타입|
|3단계|관계 타입|이진 1:1 관계 타입|
|4단계|관계 타입|이진 1:N 관계 타입|
|5단계|관계 타입|이진 M:N 관계 타입&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|
|6단계|관계 타입|N진 관계 타입|
|7단계|속성|다중값 속성|
<br/>

## 1. 개체 타입의 사상

### [1단계] 강한(정규) 개체 타입
정규 개체 타입 E의 경우 대응하는 릴레이션 R을 생성한다. 각 개체 타입의 일반 속성은 각각 새로 생성하는 릴레이션의 속성으로 표시하고, 기본키와 외래키는 PK와 FK 등으로 표시한다.

### [2단계] 약한 개체 타입
약한 개체 타입에서 생성된 릴레이션은 자신의 키와 함께 강한 개체 타입의 키를 외래키로 사상하여 자신의 기본키를 구성한다.
이때 유도된 속성이나 복합 속성 등은 속성의 성격에 맞게 판단하여 사상한다.

#### [개체 타입의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/943c573b-3081-4b89-9d88-480b85891de8" width="550" height="250"/><br/>
<br/>

## 2. 관계 타입의 사상
관계 타입은 각 관계 타입이 맺고 있는 차수와 관계 대응 수에 따라 사상 방식을 구분할 수 있다. 우선 다음과 같이 가장 기본적인 이진 관계 타입 R을 살펴보자.
이진 관계 타입 R을 사상하는 방법에는 다음과 같이 네 가지가 있다.

#### [이진 관계 타입]
<img src="https://github.com/silxbro/cs-study/assets/142463332/d8de3317-6c5f-46c0-bc9d-78a40136cc90" width="500" height="80"/><br/>

- [방법 1] 오른쪽 개체 타입 E2를 기준으로 관계 R을 표현한다.

  <img src="https://github.com/silxbro/cs-study/assets/142463332/9a40e316-2cf8-4e70-85a9-dfc5f0ade7ae" width="110" height="40"/>
- [방법 2] 왼쪽 개체 타입 E1을 기준으로 관계 R을 표현한다.

  <img src="https://github.com/silxbro/cs-study/assets/142463332/ded41ef6-74f0-4f2b-9045-ee8e08436571" width="110" height="40"/>
- [방법 3] 단일 릴레이션 ER로 모두 통합하여 관계 R을 표현한다.

  <img src="https://github.com/silxbro/cs-study/assets/142463332/ea100c63-d4c1-4ca5-b4c2-b345b8d1bb4c" width="130" height="18"/>
- [방법 4] 개체 타입 E1, E2와 관계 타입 R을 모두 독립된 릴레이션으로 표현한다.

  <img src="https://github.com/silxbro/cs-study/assets/142463332/d85f1865-a0c2-45dc-bf77-41a97f53e71c" width="80" height="60"/>

이진 관계 타입을 기준으로 관계 타입의 사상에 대해 살펴보았다.
이를 바탕으로 관계 대응 수에 따라 나타낼 수 있는 사상 방법 세 가지와 N진 관계에서 사상 방법을 살펴보면 아래와 같다.

### [3단계] 이진 1:1 관계 타입
이진 1:1 관계 타입의 경우 [방법 1]~[방법 4]까지 모든 유형으로 사상할 수 있다. 개체가 가지고 있는 정보의 유형에 따라 판단하면 된다.
하지만 [방법 4]는 불필요한 개체를 생성하기 때문에 잘 사용하지 않는다. [방법 1]이나 [방법 2] 중 외래키(FK)에 NULL 값이 덜 발생하는 방법을 사용하면 된다.
사원과 컴퓨터의 관계를 예로 들면 사원 수가 컴퓨터 대수보다 많다면 [방법 1]을, 컴퓨터 대수가 사원 수보다 많다면 [방법 2]를 사용하는 것이 좋다.

#### [이진 1:1 관계 타입의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/114676ae-3b2d-4cf5-a301-dd6076d28760" width="590" height="150"/>

### [4단계] 이진 1:N 관계 타입
이진 1:N 관계 타입의 경우 N의 위치에 따라 [방법 1] 또는 [방법 2]의 유형으로 사상된다. 아래 그림의 경우 N이 학생 개체에 위치해 있으므로 [방법 1]을 사용한다.

#### [이진 1:N 관계 타입의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/0e0dccc3-d903-4096-a064-e3276380114c" width="590" height="150"/>

### [5단계] 이진 M:N 관계 타입
이진 M:N 관계 타입은 [방법 4]의 유형으로 사상된다. 양쪽 모두 다수의 대응 수를 가지므로 새로운 릴레이션을 반드시 생성해야 한다. 새로운 릴레이션은 교차 테이블이라고 한다.

#### [이진 M:N 관계 타입의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/b57b6f58-fb63-4b7c-834a-6d687ff086bb" width="590" height="170"/>

### [6단계] N진 관계 타입
ER 모델의 차수가 3 이상인 다진 관계 타입의 경우 [방법 4]의 유형으로 사상된다. 그리고 생성되는 릴레이션 R의 키는 각 개체 타입의 기본키를 모은 복합키를 사용한다.

#### [N진 관계 타입의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/b6b4de46-7ad1-4ca8-8fa1-dc058531c152" width="590" height="180"/>
<br/>

## 3. 다중값 속성의 사상
속성의 사상 시 단일 값으로 표현된 속성은 특별한 문제 없이 관계 데이터 모델로 직접 사상할 수 있다. 하지만 다중값 속성의 경우 직접 사상할 수 없다.
다중값 속성은 취미가 (등산, 스키, 노래)인 것과 같이 하나의 속성에 여러 값을 가질 수 있는 속성을 말한다.
다중값 속성을 가진 ER 모델을 관계 데이터 모델로 사상하는 방법에는 다음과 같이 두 가지가 있다.

#### [다중값 속성의 사상]
<img src="https://github.com/silxbro/cs-study/assets/142463332/ba96a6af-e7b4-493a-921e-17beeb51fcd5" width="580" height="140"/>

### [7단계] 다중값 속성
속성의 개수를 알 수 없는 경우 [방법 1]을, 속성의 개수가 제한적으로 정해지는 경우 [방법 2]를 사용한다.
- [방법 1] 다중값 속성의 개수를 알 수 없는 경우

  <img src="https://github.com/silxbro/cs-study/assets/142463332/104c76ab-a39b-4baa-bd91-63c54e62ff96" width="65" height="40"/>

    - 다중값 속성의 개수를 알 수 없는 경우 다음과 같이 새로운 릴레이션을 생성한다. 취미, 특기, 친구 속성과 같이 다중값이지만 개수를 알 수 없을 때 사용한다.
      개체 타입은 다중값 속성을 제외하고 모두 R로 사상하고, 다중값 속성은 개체 타입의 키와 함께 새로운 릴레이션(RC)을 생성한다.
      이때 RC는 기존의 키와 함께 자신의 값이 모두 키로 지정되어야 한다.

- [방법 2] 다중값 속성의 개수가 적고 제한 가능한 경우

  <img src="https://github.com/silxbro/cs-study/assets/142463332/d4f180d1-b3fa-4b71-9927-48b9ccea8ae8" width="130" height="18"/>

    - 다중값 속성의 개수가 적고 제한 가능한 경우, 속성을 릴레이션에 같이 포함한다. 학위 속성과 같이 속성의 값이 학사, 석사, 박사 등 다중값이지만 수가 제한적일 때 사용한다.
      위의 경우 속성 C는 속성 값이 세 개뿐이므로 그 이상은 저장할 필요가 없다. 따라서 C1, C2, C3를 별도의 속성으로 구성한다.
      하지만 이 방법은 고려해야 할 속성 값이 많아지면 불필요한 속성이 생겨 비효율적이다. 또한 이후에 처음보다 많은 속성 값을 저장해야하는 등의 문제가 생길 수 있다.

[방법 1]은 새로 생성된 릴레이션 RC에 값이 계속 저장될 수 있어 [방법 2]보다 효율적이다. 그러나 새로운 릴레이션이 생기게 되어 모델이 복잡해질 수 있다.

- 학생에 관한 개체를 모델링할 경우 다음과 같이 취미 속성을 앞에서 설명한 [방법 1]로 나타낼 수 있다.
  #### [다중값 속성의 사상]
  <img src="https://github.com/silxbro/cs-study/assets/142463332/13e30bef-fc52-4456-ab27-ca2eadb131f0" width="460" height="140"/>