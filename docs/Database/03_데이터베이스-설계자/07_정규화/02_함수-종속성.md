# 함수 종속성
<br/>

## 1. 함수 종속성의 개념
이상현상이 발생하는 테이블을 수정하여 정상으로 만드는 과정을 정규화(normalization)라고 한다. 정규화를 하기 위해서는 먼저 테이블을 분석하여 기본키와 함수 종속성을 파악해야 한다.
다음 예를 보면서 함수 종속성의 개념을 이해해보자.
- 릴레이션과 테이블은 같은 의미로 쓰이는 용어이다.
  릴레이션은 수학의 릴레이션에 기초한 용어로 구조를 강조하는 측면이 있고, 테이블은 실무에서 많이 사용하는 용어로 구조보다는 데이터를 강조하는 측면이 있다.
  함수 종속성은 릴레이션 구조에 관한 이론적인 내용을 많이 포함하고 있다. 여기서부터는 테이블 대신 릴레이션이라는 용어를 사용한다. 또 행, 열 대신 튜플, 속성이라는 용어를 사용한다.

다음 그림은 마당대학의 학생 정보와 수강 정보를 저장하는 학생수강성적 릴레이션이다.
#### [학생수강성적 릴레이션]
|학생번호|학생이름|주소|학과|학과사무실|강좌이름|강의실|성적|
|:---|:---|:---|:---|:---|:---|:---|:---|
|501|박지성|영국 맨체스타|컴퓨터과|공학관 101|데이터베이스|공학관 110|3.5|
|401|김연아|대한민국 서울|체육학과|체육관 101|데이터베이스|공학관 110|4.0|
|402|장미란|대한민국 강원도|체육학과|체육관 101|스포츠경영학|체육관 103|3.5|
|502|추신수|미국 클리블랜드|컴퓨터과|공학관 101|자료구조|공학관 111|4.0|
|501|박지성|영국 맨체스타|컴퓨터과|공학관 101|자료구조|공학관 111|3.5|

학생수강성적 릴레이션의 각 속성 사이에는 의존성이 존재한다. 예를 들어 강좌이름이 '데이터베이스'인 경우 강의실은 '공학관 110호' 한 곳뿐이다.
반면 학생이름이 '박지성'인 경우 강좌이름은 '데이터베이스'도 있고 '자료구조'도 있다. 강의실은 강좌이름만 알면 바로 알 수 있지만 강좌이름은 학생이름만으로 바로 알 수 없다.

이와 같이 어떤 속성 A의 값을 알면 다른 속성 B의 값이 유일하게 정해지는 의존 관계를 '속성 B는 속성 A에 종속한다(dependent)' 혹은 '속성 A는 속성 B를 결정한다(determine)'라고 한다.
이 관계를 'A → B'로 표기하며, A는 B의 결정자라고 한다. 학생수강성적 릴레이션에서 종속관계에 있는 예는 다음과 같다.
- 학생번호 → 학생이름
- 학생번호 → 주소
- 강좌이름 → 강의실
- 학과 → 학과사무실

종속하지 않는 예는 다음과 같다. 한 속성 값에 대해 두 개 이상의 값이 있는 경우이다.
- 학생이름 → 강좌이름
- 학과 → 학생번호

또 종속하는 것처럼 보이지만 주의 깊게 보면 그렇지 않은 예도 있다.
- 학생이름 → 학과

현재 상태에서는 학생이름을 알면 바로 학과를 알 수 있지만 만약 동명이인인 김연아 학생이 컴퓨터과에 등록을 한다면 학생이름만으로 학과를 알 수 없다.
함수 종속성을 판단할 때는 릴레이션의 현재 인스턴스(데이터)만을 가지고 판단하는 것이 아니라 속성이 갖는 의미를 가직 판단해야 한다.

학생수강성적 릴레이션의 종속관계 몇 개만 살펴보면 다음과 같다. 종속관계인 경우 연결하는 선에 ○를, 그렇지 않은 경우 ✕를 표시하였다.
#### [학생수강성적 릴레이션의 종속관계]
<img src="https://github.com/silxbro/cs-study/assets/142463332/4c29d784-e3ae-4bc1-afa4-3dc6d4444b0c" width="330" height="200"/><br/>

수학에서 변수 x와 y 사이에 x 값이 정해지면 y 값이 정해지는 관계를 'y는 x의 함수'라고 한다.
마찬가지로 '학생번호 → 주소'와 같이 왼쪽 속성의 모든 값에 대하여 오른쪽 속성의 값이 유일하게 결정될 때 '함수적으로 종속한다(functionally dependent)'라고 한다.
릴레이션의 속성 간에 함수적으로 종속하는 성질을 '함수 종속성(FD, functional dependency)' 혹은 원어를 모두 해석하여 '함수적 종속성'이라고 한다.

#### [함수 종속성(FD, Functional Dependency)]
릴레이션 R과 R에 속하는 속성의 집합 X,Y가 있을 때, X 각각의 값이 Y의 값 한 개와 대응이 될 때 'X는 Y를 함수적으로 결정한다'라고 하고 X → Y로 표기한다.
이때 X를 결정자(deteminant)라고 하고, Y를 종속 속성(dependent attribute)이라고 한다. 함수 종속성은 보통 릴레이션 설계 때 속성의 의미로부터 정해진다.
<br/>
<br/>
## 2. 함수 종속성 다이어그램
함수 종속성을 나타내는 표기법으로 함수 종속성 다이어그램(functional dependency diagram)이 있다.
함수 종속성 다이어그램은 릴레이션의 속성을 직사각형, 속성 간의 함수 종속성을 화살표로 나타낸다. 복합 속성의 경우 직사각형으로 묶어서 그린다.

학생수강성적 릴레이션에서 함수 종속성을 찾아 정리하면 다음과 같다. 한 가지 주의 깊게 봐야할 점은 결정자가 복합 속성일 수 있다는 점이다.
- 학생번호 → 학생이름
- 학생번호 → 학과
- 학생번호 → 주소
- 학과 → 학과사무실
- 강좌이름 → 강의실
- (학생번호, 강좌이름) → 성적
    - 학생번호와 강좌이름을 합하여 보면 성적을 알 수 있다.

이를 다이어그램을 표현하면 다음과 같다.
#### [학생수강성적 릴레이션의 함수 종속성 다이어그램]
<img src="https://github.com/silxbro/cs-study/assets/142463332/340c153d-bf3c-4f9b-8d7f-42fb8619d620" width="350" height="170"/><br/>
<br/>
<br/>
## 3. 함수 종속성 규칙
릴레이션에는 당연히 성립하는 종속관계가 있다. 'X → X'와 같은 자기 자신에 대한 것이다.
또 릴레이션에 존재하는 모든 종속관계의 집합 {X → Y, ...}을 구하면 이 집합으로부터 유도할 수 있는 종속관계가 있다. 다음은 이러한 함수 종속성 규칙에 대한 정의이다.
#### [함수 종속성 규칙 (functional dependency rule)]
X, Y, Z가 릴레이션 R에 포함된 속성의 집합이라고 할 때, 함수 종속성에 관한 다음과 같은 규칙이 성립된다.
- 부분집합(subset) 규칙 : If Y ⊆ X, then X → Y
- 증가(augmentation) 규칙 : If X → Y, then XZ → YZ
- 이행(transitivity) 규칙 : If X → Y and Y → Z, then X → Z

위 세 가지 규칙으로부터 부가적으로 다음의 규칙을 얻을 수 있다.
- 결합(union) 규칙 : If X → Y and X → Z, X → YZ
- 분해(decomposition) 규칙 : If X → YZ, then X → Y and X → Z
- 유사이행(pseudotransitivity) 규칙 : If X → Y and  WY → Z, then WX → Z

위 함수 종속성 규칙을 이용하여 학생수강성적 릴레이션에서 유도할 수 있는 종속관계를 찾아보면 다음과 같다.
#### [학생수강성적 릴레이션에 함수 종속성 규칙을 적용한 예]
|적용규칙|사례|설명|
|:---|:---|:---|
|부분집합 규칙|(학과, 주소) → 학과|학과는 (학과, 주소)의 부분집합 속성이므로 '(학과, 주소) → 학과' 성립|
|증가 규칙|(학생번호, 강좌이름) →<br/>(학생이름, 강좌이름)|'학생번호 → 학생이름'이므로 강좌이름을 추가하여,<br/>'(학생번호, 강좌이름) → (학생이름, 강좌이름)' 성립|
|이행 규칙|학생번호 → 학과사무실|'학생번호 → 학과', '학과 → 학과사무실'이므로 이행 규칙을 적용하여,<br/>'학생번호 → 학과사무실' 성립|
|결합 규칙|학생번호 →<br/>(학생이름, 주소)|'학생번호 → 학생이름', '학생번호 → 주소'이므로 결합 규칙을 적용하여,<br/>학생번호 → (학생이름, 주소)' 성립|
|분해 규칙|학생번호 → 학생이름,<br/>학생번호 → 주소|'학생번호 → (학생이름, 주소)'이므로 분해하여,<br/>'학생번호 → 학생이름', '학생번호 → 주소' 성립|
|유사이행 규칙|(강좌이름, 학생이름)<br/>→ 성적|'학생이름 → 학생번호'(학생이름이 같은 경우가 없다고 가정한다),<br/>'(강좌이름, 학생번호) → 성적'이므로 유사이행 규칙을 적용하여,<br/>'(강좌이름, 학생이름) → 성적' 성립|
<br/>

## 4. 함수 종속성과 기본키
릴레이션의 함수 종속성을 파악하기 위해서는 우선 기본키를 찾아야 한다. 기본키가 함수 종속성에서 어떤 역할을 하는지 알면 이상현상을 제거하는 정규화 과정을 쉽게 이해할 수 있다.

#### [함수 종속성과 기본키]
릴레이션 R(K, A1, A2, A3, ..., An)에서 K가 기본키이면, K → R이 성립한다. 즉, 기본키는 릴레이션의 모든 속성에 대해 결정자(determinant)이다.

릴레이션이 R(K, A, B, C)로 구성되어 있고 K가 기본키라고 하자. 릴레이션에서 기본키 값은 유일하기 때문에 같은 값을 갖는 K는 없다.
기본키 K의 k 값에 대하여 속성 A의 값이 a1, a2를 갖는 경우는 없다(하나의 기본키 값에 대하여 두 개 이상의 튜플이 존재하지 않는다). 그러므로 K → A, K → B, K → C가 성립한다.
여기에 함수 종속성 규칙을 적용하면 K → KABC가 성립하므로 K → R임을 알 수 있다.

아래의 학생 릴레이션을 보면서 이해해보자. 이름이 같은 학생이 없다고 가정하면, '이름 → 학과, 이름 → 주소, 이름 → 취득학점'이므로 '이름 → 이름, 학과, 주소, 취득학점'이 성립한다.
즉 이름 속성이 학생 릴레이션의 전체를 결정한다.
#### [학생 릴레이션]
|이름|학과|주소|취득학점|
|:---|:---|:---|:---:|
|박지성|컴퓨터과|영국 맨체스타|92|
|김연아|체육학과|대한민국 서울|95|
|장미란|체육학과|대한민국 강원도|98|
|추신수|컴퓨터과|미국 클리블랜드|99|
<br/>

## 5. 이상현상과 결정자
이상현상은 한 개의 릴레이션에 두 개 이상의 정보가 포함되어 있을 때 나타난다.
학생수강성적 릴레이션의 경우 학생 정보(학생번호, 학생이름, 주소, 학과)와 강좌 정보(강좌이름, 강의실)가 한 릴레이션에 포함되어 있기 때문에 이상현상이 나타난다.

학생수강성적 릴레이션의 함수 종속성 다이어그램 그림에서 알 수 있듯이 기본키는 (학생번호, 강좌이름)의 복합키이다.
여기서 (강좌이름, 강의실)만 따로 보면 '강좌이름'이 이 부분 릴레이션(sub-relation)의 기본키가 된다.
또 (학생번호, 학생이름, 학과, 주소)만 따로 보면 '학생번호'가 이 부분 릴레이션의 기본키가 된다.
즉 학생수강성적 릴레이션의 기본키를 제외한 다른 속성이 부분 릴레이션을 형성하고 있으며, 각 부분 릴레이션의 기본키가 된다.

학생수강성적 릴레이션에서 함수 종속성을 모두 살펴보면 결정자는 '(학생번호, 강좌이름)', '학생번호', '강좌이름', '학과'다.
'(학생번호, 강좌이름)'은 기본키면서 결정자(determinant)이다. 반면 '학생번호', '강좌이름', '학과'는 기본키가 아니면서 결정자다.
이상현상은 **기본키가 아니면서 결정자인 속성**(비후보키 결정자 속성)이 있을 때 발생한다.

학생수강성적 릴레이션에서 부분 릴레이션을 분해해보자. 분해할 때 부분 릴레이션의 결정자는 원래 릴레이션에 남겨두어야 한다.
그래야 분해된 부분 릴레이션이 원래 일레이션과 관계를 형성할 수 있다.

### [1단계] 학생수강성적 릴레이션에서 (강좌이름, 강의실)을 분리
- 학생수강성적1 (학생번호, 학생이름, 학과, 주소, 강좌이름, 성적, 학과사무실)
- 강의실(강좌이름, 강의실)

#### [1단계 분해]
<img src="https://github.com/silxbro/cs-study/assets/142463332/f89d43c6-dca1-4dcf-bb7c-0a0669525c9b" width="580" height="200"/><br/>

### [2단계] 학생수강성적1 릴레이션에서 (학생번호, 강좌이름, 성적)을 분리
- 학생학과(학생번호, 학생이름, 학과, 주소, 학과사무실)
- 학생성적(학생번호, 강좌이름, 성적)
- 강의실(강좌이름, 강의실)

#### [2단계 분해]
<img src="https://github.com/silxbro/cs-study/assets/142463332/9fe83244-839a-4329-a92e-84cc83b7243e" width="470" height="270"/><br/>

### [3단계] 학생학과 릴레이션에서 (학과, 학과사무실)을 분리
- 학생(학생번호, 학생이름, 학과, 주소)
- 학과(학과, 학과사무실)
- 학생성적(학생번호, 강좌이름, 성적)
- 강의실(강좌이름, 강의실)

#### [최종 분해 결과]
<img src="https://github.com/silxbro/cs-study/assets/142463332/68e577e4-355a-4615-b490-dfb26757f151" width="470" height="270"/><br/>

최종 분해된 모습은 위와 같다. 분해된 네 개의 릴레이션에서는 더 이상 이상현상이 발생하지 않는다.
또한 데이터 간의 관계를 유지하는 공통 속성을 가지고 있기 때문에 원래 릴레이션의 정보는 모두 포함한다.
<br/>
<br/>
## 6. 함수 종속성 예제
함수 종속성은 보통 릴레이션을 설계할 때 속성의 의미를 보고 파악하지만, 역으로 릴레이션에 저장된 속성 값을 보고 추정할 수 있다.
다음 예제를 통해 속성의 의미가 주어지지 않은 릴레이션에서 함수 종속성을 찾아보자.

#### [예제 7-1] 다음 릴레이션 R에서 아래 함수 종속성이 성립하는지 살펴보시오.
#### R
<img src="https://github.com/silxbro/cs-study/assets/142463332/61eb0c32-9c75-4177-a943-ade964e70ebf" width="200" height="140"/><br/>
- A → B
    - 성립하지 않는다. A의 e에 대해 B의 i와 b가 대응한다.
- B → C
    - 성립한다. B 값에 대하여 C의 값이 한 개씩만 대응한다.
- (B,C) → A
    - 성립하지 않는다. (i,f) 값에 대하여 e와 g가 대응한다.
- (A,B) → C
    - 성립한다. 모든 튜플의 (A,B) 값이 다르다.

#### [예제 7-2] 다음 릴레이션 R에서 성립하는 함수 종속성을 모두 찾아보시오.
#### R
<img src="https://github.com/silxbro/cs-study/assets/142463332/2c93b2cc-0d38-4810-890b-671cf4f19955" width="250" height="160"/><br/>
- [풀이]
    - 결정자가 한 개인 경우 : B → C, C → B, D → A, D → B, D → C
    - 결정자가 두 개인 경우 : AB → C, AB → D, AC → B, AC → D, AD → B, AD → C, BD → A, BD → C, CD → A, CD → B
    - 결정자가 세 개인 경우 : ABC → D, ABD → C, ACD → B, BCD → A
- [설명]
    - 한 릴레이션의 함수 종속 X → Y에서 가능한 X의 경우의 수는 많다. 그러나 이러한 함수 종속성을 모두 찾을 필요는 없다.
      예를 들어 D → A가 성립한다면 함수 종속성 규칙에 따라 결정자 D쪽에 어떤 속성을 추가해도 함수 종속성은 성립한다. 따라서 D → A가 성립하면 BD → A, CD → A는 당연히 성립한다.
      같은 방법으로 결정자가 세 개인 경우까지 찾아내면 더 이상 찾을 필요가 없다.
      위 풀이의 정답은 함수 종속성 규칙으로 유추되는 종속성을 제외하고 순수한 함수 종속만 적어주면 된다.
        - B → C, C → B, D → A, D → C, AB → D, AC → D